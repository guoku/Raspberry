{% extends "base.html" %}
{% load i18n staticfiles %}
{% load web_common entity %}

{% block title %}
    {{ query_user_context.nickname|default:'我的果库' }}
    {% block subtitle %}{% endblock %}
{% endblock %}
{% block keyword %}果库,{{ query_user_context.nickname }}{% endblock %}
{% block description %}果库,{{ query_user_context.nickname }},{{ query_user_context.bio }}{% endblock %}

{#{% block css %}#}
{#    <link rel="stylesheet" type="text/css" href="{% static 'styles/user.css' %}">#}
{#{% endblock %}#}

{% block content %}
    {% url 'web_user_likes' query_user_context.user_id as web_user_likes_url %}
    {% url 'web_user_notes' query_user_context.user_id as web_user_notes_url %}
    {% url 'web_user_tags' query_user_context.user_id as web_user_tags_url %}
    {% url 'web_user_fans' query_user_context.user_id as web_user_fans_url %}
    {% url 'web_user_followings' query_user_context.user_id as web_user_followings_url %}

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="media" style="border: 1px solid #eee; padding: 20px;">
                    <a class="pull-left" href="#">
                        <img class="media-object img-responsive img-circle" src="{{ query_user_context.avatar_large }}" alt="{{ query_user_context.nickname }}" width="100" height="100" />
                    </a>
                    {% if relation == 4 %}
                        <a class="btn btn-default pull-right" href="{% url 'web_setting' %}"><i class="fa fa-cog fa-lg"></i>&nbsp; {% trans 'settings' %}</a>
                    {% elif relation == 3 %}
                        <a class="follow is-fan btn btn-cancel pull-right" href="{% url 'web_follow' query_user_context.user_id 0 %}"><i class="fa fa-exchange fa-lg"></i>&nbsp; 取消关注</a>
                    {% elif relation == 1 %}
                        <a class="follow btn btn-cancel pull-right" href="{% url 'web_follow' query_user_context.user_id 0 %}"><i class="fa fa-check fa-lg"></i>&nbsp; 取消关注</a>
                    {% elif relation == 2 %}
                        <a class="follow is-fan btn btn-primary pull-right" href="{% url 'web_follow' query_user_context.user_id 1 %}"><i class="fa fa-plus"></i>&nbsp; 关注</a>
                    {% elif relation == 0 %}
                        <a class="follow btn btn-primary pull-right" href="{% url 'web_follow' query_user_context.user_id 1 %}"><i class="fa fa-plus" ></i>&nbsp; 关注</a>
                    {% endif %}

                    <div class="media-body">
                        <h4 class="media-heading">{{ query_user_context.nickname }}</h4>
                        <p>{{ query_user_context.bio }}</p>
                        <address>{{ query_user_context.location }}  {{ query_user_context.city }}</address>
                    </div>

                    {% if request.user.is_staff %}
                        <a class="btn btn-default pull-right" href="{% url 'management_edit_user' query_user_context.user_id %}" target="_blank"><i class="fa fa-edit fa-lg"></i></a>
                    {% endif %}
                </div>


                <div class="navbar nav-user-index">
                    <ul class="nav nav-pills pull-left" role="tablist">
                        <li role="presentation" {% if web_user_likes_url in request.path %}class="active"{% endif %}>
                            <a href="{{ web_user_likes_url }}">{% trans 'likes' %}&nbsp; <strong>{{ query_user_context.like_count }}</strong></a>
                        </li>
                        <li role="presentation" {% if web_user_notes_url in request.path %}class="active"{% endif %}>
                            <a href="{{ web_user_notes_url }}">{% trans 'notes' %}&nbsp; <strong>{{ query_user_context.entity_note_count }}</strong></a>
                        </li>
                        <li role="presentation" {% if web_user_tags_url in request.path %}class="active" {% endif %}>
                            <a href="{{ web_user_tags_url }}">{% trans 'tags' %}&nbsp; <strong>{{ query_user_context.tag_count }}</strong></a>
                        </li>
                    </ul>
                    <ul class="nav nav-pills pull-right hidden-xs" role="tablist">
                        <li role="presentation" {% if web_user_followings_url in request.path %}class="active"{% endif %}>
                            <a href="{{ web_user_followings_url }}">关注了&nbsp; <strong>{{ query_user_context.following_count }}</strong>人</a>
                        </li>
                        <li role="presentation" {% if web_user_fans_url in request.path %}class="active"{% endif %}>
                            <a href="{{ web_user_fans_url }}">关注者&nbsp; <strong>{{ query_user_context.fan_count }}</strong></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        {% if web_user_likes_url in request.path %}
            <div class="row">
                <div class="col-md-12">
                <ul class="nav nav-pills nav-home" role="tablist">
                    <li {% if curr_category_id == 0 %}role="presentation" class="disabled"{% endif %}><a href="{{ web_user_likes_url }}">所有</a></li>
                    {% for category in category_list %}
                        {% if category.category_id == 12 %}
{#                            {%  %}#}
                        {% else %}
                        <li {% if category.category_id == curr_category_id %}role="presentation" class="disabled"{% endif %}>
                            <a href="{{ web_user_likes_url }}?c={{ category.category_id }}">{{ category.category_title }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}
                </ul>
                </div>
            </div>
            <div class="row">

                {% for entity_context in entity_list %}
                    {% include "common/entity.html" with entity_context=entity_context %}
                {% endfor %}
            </div>
        {% endif %}

        {% if web_user_notes_url in request.path %}
            <div class="row">
                {% for note in note_list %}
{#                    {% include "common/entity.html" with entity_context=note.entity_context %}#}
                    <div class="col-xs-6 col-sm-3">
    <div class="thumbnail">
        <div class="img-box">
            <a href="{% url 'web_detail' note.entity_context.entity_hash %}">
                <img class="img-responsive" alt="{{ note.entity_context.title }}" src="{{ note.entity_context.chief_image.url|resize:'240' }}">
            </a>
        </div>
        <div class="caption">
{#            <div class="pull-left">#}
{#            {% if entity_context.is_user_already_like %}#}
{#                    <i class="fa fa-heart fa-lg"></i>&nbsp; {% trans 'likes' %} <span>{{ entity_context.like_count }}</span>#}
{#                </a>#}
{#            {% else %}#}
{#                <a class="btn btn-like" href="{% url 'web_like_entity' entity_context.entity_id '1' %}" target="_blank">#}
{#                    <i class="fa fa-heart-o fa-lg"></i>&nbsp; {% trans 'likes' %} <span>{{ entity_context.like_count }}</span>#}
{#                </a>#}
{#            {% endif %}#}
            <a class="btn btn-like" href="{% url 'web_like_entity' note.entity_context.entity_id '1' %}" target="_blank">
                {% if note.is_user_already_like %}
                    <i class="fa fa-heart fa-lg"></i>
                {% else %}
                    <i class="fa fa-heart-o fa-lg"></i>
                {% endif %}
                {% trans 'likes' %} <span class="like-count">{{ note.entity_context.like_count }}</span>
            </a>
{#            </div>#}
        </div>
    </div>
</div>
                {% endfor %}
            </div>
        {% endif %}

        {% if web_user_tags_url in request.path %}
            <div class="row">
                {% for tag_context in tag_list %}
                    {% include "common/tag.html" with tag_context=tag_context user_id=query_user_context.user_id %}
                {% endfor %}
            </div>
        {% endif %}

        {% if web_user_followings_url in request.path %}
            <div class="row">
                {% for user_context in user_list %}
                    {% include "common/user.html" with user_context=user_context %}
                {% endfor %}
            </div>
        {% endif %}

        {% if web_user_fans_url in request.path %}
            <div class="row">
                {% for user_context in user_list %}
                    {% include "common/user.html" with user_context=user_context %}
                {% endfor %}
            </div>
        {% endif %}
{#        </div>#}

        {% if paginator %}
            {% include "common/web_paginator.html" with paginator=paginator %}
        {% endif %}
    </div>

{% endblock %}
