{% load i18n staticfiles %}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="apple-itunes-app" content="app-id=477652209"/>
    <meta charset="utf8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="msapplication-tap-highlight" content="no" />
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <title>分享微博，赢大奖！</title>

    <style type="text/css">
            html, body, div, ul, li, a, p, span, header, footer, input, textarea, h1, h2 {margin: 0;padding: 0;-webkit-tap-highlight-color: rgba(255,255,255,0);-webkit-appearance: none;}
            article, aside, canvas, details, figcaption, figure, footer, header, hgroup, menu, nav, section, summary {display: block;}
            html, body {height: 100%;-webkit-text-size-adjust: none;text-size-adjust: none;font-family:helvetica neue,helvetica,arial,sans-serif;text-align: center;}
            body {font: normal 14px sans-serif;background-color: #F;color: #898989;}
            a {text-decoration:none;}
            .dn {/*display: none;*/}
            .clear {clear:both;}
            .sina-btn {display:block;background:#427ec0;color:#ffffff;padding:6px 0 10px 0;border-radius:2px;margin: 0 auto;width:110px;height: 12px;font-size: 12px;margin-top:68px;}
            div.with-border {box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);background-color:#FFFFFF;border-radius:2px;margin:15px 5px 0 5px;}
    
            .main {position:relative;width:100%;overflow:hidden;padding-bottom:10px;}
            .main>div {width:320px;margin-left:-160px;left:50%;position:relative;overflow:hidden;}
    
            .rotate {
                width:320px;margin-left:-160px;left:50%;position:relative;padding-bottom:5px;overflow:hidden;height: 280px;margin-top: 170px;
            }
            .rotate-bg 
            {
                position:absolute;
                width:252px;
                height:252px;
                top:9px;
                left:29px;
                background:url({% static 'images/rotate-bg.png' %});
                -webkit-background-size:252px 252px;
                background-size:252px 252px;
            }
            .header
            {
                position:absolute;
                width:320px;
                height:488px;
                background:url({% static 'images/bg.png' %}) no-repeat;
                -webkit-background-size:320px 488px;
                background-size:320px 488px;
                margin-top: 0px;
            }
            .rotate .btn-lottery {
                width:115px;
                height:115px;
                position:absolute;
                top:78px;
                left:98px;
                background:url({% static 'images/btn.png' %});
                -webkit-background-size:115px 115px;
                background-size:115px 115px;
                cursor: pointer;
            }
            #award-winner{width:1000px;height:20px;overflow:hidden;line-height:20px;font-size:10px;} 
            #award-winner #scroll_begin, #award-winner #scroll_end{display:inline} 
        </style>
    <script type="text/javascript"> 
            function ScrollImgLeft(){ 
            var speed=50; 
            var scroll_begin = document.getElementById("scroll_begin"); 
            var scroll_end = document.getElementById("scroll_end"); 
            var scroll_div = document.getElementById("scroll_div"); 
            scroll_end.innerHTML=scroll_begin.innerHTML; 
            function Marquee(){ 
            if(scroll_end.offsetWidth-scroll_div.scrollLeft<=0) 
            scroll_div.scrollLeft-=scroll_begin.offsetWidth; 
            else 
            scroll_div.scrollLeft++; 
            } 
            var MyMar=setInterval(Marquee,speed); 
            //scroll_div.onmouseover=function() {clearInterval(MyMar);} 
            //scroll_div.onmouseout=function() {MyMar=setInterval(Marquee,speed);} 
            } 
        </script></head>

<body>
    <div class="main" id="main">
        <div class="header">
            <div class="rotate">
                <div class="rotate-bg"></div>
                <div class="btn-lottery"></div>
            </div>
        </div>
        <div style="text-align:left;color:#898989;font-size:11px;line-height:150%;">
            <div style="padding:10px 25px 10px 25px;">
                <p style="margin-top:0px;">
                    <span style="font-size:13px;color:#666;">活动时间：</span>
                    2014年4月16日 - 4月22日
                </p>
                <p style="margin-top:10px;">
                    <span style="font-size:13px;color:#666;">活动规则：</span>
                    成功分享至微博即可获得1次抽奖机会，每人每天最多2次抽奖机会。
                </p>
                <p style="margin-top:10px;">
                    <span style="font-size:13px;color:#666;">奖品介绍：</span>
                    云悦体质分析仪（30台）限量版瑜伽球（30个）定制鼠标垫（50个）。
                </p>
                <p style="margin-top:10px;">本活动一切解释权归果库所有。若发现作弊及僵尸用户，果库有权取消其获奖资格。</p>
            </div>
        </div>
        <a href="{% url 'lotto_share_to_sina_weibo' %}?session={{session}}&token={{token}}">
            <div id="sina-btn" class="sina-btn">
                <img src="{% static 'images/sina.png' %}" width="17" height="13" style="display:inline-block;"><span>&nbsp;分享到微博</span>
            </div>
        </a>
    </div>
</body>
</html>

<script src="{% static 'scripts/jquery.js' %}"></script>
<script src="{% static 'scripts/jqueryrotate.js' %}"></script>
<script type="text/javascript">
    {% if infocode == '0' %}
        alert('每天只能分享两次哦');
    {% elif infocode == '1' %}
        alert('分享成功，开始抽奖！');
    {% endif %}
</script>
<script type="text/javascript">
    var count = {{count}};
    var token = "{{token}}";
    var session = "{{session}}";
    
    $(function () {
        var rotateStart = function (awards, angle, text) {  //awards:奖项，angle:奖项对应的角度
            $('.btn-lottery').stopRotate();
            $(".btn-lottery").rotate({
                angle: 0,
                duration: 5000,
                animateTo: angle + 1440, //angle是图片上各奖项对应的角度，1440是我要让指针旋转4圈。所以最后的结束的角度就是这样子^^
                callback: function () {
                    alert(text)
                }
            });
        };
        {% if infocode == '1' %}
            $.ajax({
                url: "{% url 'lotto_roll' %}?session={{session}}&token={{token}}",
                data: {
                  "session" : session,
                  "token" : token 
                },
                type: "GET",
                success: function(data) {
                    var code = data['code'];
                    var count = data['leftrollcount'];
                    if (code == 0) {
                        var angle = [0, 120, 240];
                        angle = angle[Math.floor(Math.random() * angle.length)]
                        rotateStart(0, angle, '很遗憾，这次你没中奖')
                    }
                    if (code == 1) {
                        rotateStart(1, 180, '恭喜你抽中一等奖：Beats 耳机（限量版）')
                    }
                    if (code == 2) {
                        rotateStart(2, 300, '恭喜你抽中二等奖：音乐花园创意音箱')
                    }
                    if (code == 3) {
                        rotateStart(3, 60, '恭喜你抽中三等奖：果库惊喜礼袋')
                    }
                    if (code == 4) {
                        alert('每天只有两次机会哦')
                    }
                    if (code == 5) {
                        alert('请先分享到微博')
                    }

                },
                error: function(data) {

            }});
        {% endif %}

        $(".btn-lottery").rotate({
            bind: {
                click: function () {
                    window.location.href = "{% url 'lotto_share_to_sina_weibo' %}?session={{session}}&token={{token}}";
                }
            }
        });
    });
</script>
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24696872-5']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
