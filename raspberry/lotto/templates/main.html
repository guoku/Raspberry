{% load i18n staticfiles %}
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="apple-itunes-app" content="app-id=477652209"/>
        <meta charset="utf8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
        <meta name="msapplication-tap-highlight" content="no" />
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <title>分享微博，赢大奖！</title>
    
        <style type="text/css">
            html, body, div, ul, li, a, p, span, header, footer, input, textarea, h1, h2 {margin: 0;padding: 0;-webkit-tap-highlight-color: rgba(255,255,255,0);-webkit-appearance: none;}
            article, aside, canvas, details, figcaption, figure, footer, header, hgroup, menu, nav, section, summary {display: block;}
            html, body {height: 100%;-webkit-text-size-adjust: none;text-size-adjust: none;font-family:helvetica neue,helvetica,arial,sans-serif;text-align: center;}
            body {font: normal 14px sans-serif;background-color: #F;color: #898989;}
            a {text-decoration:none;}
            .dn {/*display: none;*/}
            .clear {clear:both;}
            .sina-btn {display:block;background:#427ec0;color:#ffffff;padding:10px 0 16px 0;border-radius:2px;margin: 0 auto;width:188px;height: 12px;font-size: 16px;}
            div.with-border {box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);background-color:#FFFFFF;border-radius:2px;margin:15px 5px 0 5px;}
    
            .main {position:relative;width:100%;overflow:hidden;padding-bottom:10px;}
            .main>div {width:309px;margin-left:-154px;left:50%;position:relative;padding-bottom:5px;overflow:hidden;}
    
            .rotate {
                width:320px;margin-left:-160px;left:50%;position:relative;padding-bottom:5px;overflow:hidden;height: 280px;
            }
            .rotate-bg 
            {
                position:absolute;
                width:252px;
                height:252px;
                top:9px;
                left:29px;
                background:url({% static 'images/rotate-bg.png' %});
                -webkit-background-size:252px 252px;
                background-size:252px 252px;
            }
            .header
            {
                position:absolute;
                width:320px;
                height:110px;
                background:url({% static 'images/header.png' %});
                -webkit-background-size:320px 110px;
                background-size:320px 110px;
            }
            .rotate .btn-lottery {
                width:115px;
                height:115px;
                position:absolute;
                top:78px;
                left:98px;
                background:url({% static 'images/btn.png' %});
                -webkit-background-size:115px 115px;
                background-size:115px 115px;
                cursor: pointer;
            }
            #award-winner{width:1000px;height:20px;overflow:hidden;line-height:30px;font-size:13px;} 
            #award-winner #scroll_begin, #award-winner #scroll_end{display:inline} 
        </style>
        <script type="text/javascript"> 
            function ScrollImgLeft(){ 
            var speed=50; 
            var scroll_begin = document.getElementById("scroll_begin"); 
            var scroll_end = document.getElementById("scroll_end"); 
            var scroll_div = document.getElementById("scroll_div"); 
            scroll_end.innerHTML=scroll_begin.innerHTML; 
            function Marquee(){ 
            if(scroll_end.offsetWidth-scroll_div.scrollLeft<=0) 
            scroll_div.scrollLeft-=scroll_begin.offsetWidth; 
            else 
            scroll_div.scrollLeft++; 
            } 
            var MyMar=setInterval(Marquee,speed); 
            //scroll_div.onmouseover=function() {clearInterval(MyMar);} 
            //scroll_div.onmouseout=function() {MyMar=setInterval(Marquee,speed);} 
            } 
        </script>
    </head>
    
    <body>
        <div class="main" id="main">
            <div class="header">
                <div id="award-winner" style="margin-top:86px;font-size:10px;color:#5f4614">
                    <div style="width:900px;height:20px;white-space: nowrap;overflow:hidden;" id="scroll_div" class="scroll_div">
                        <div id="scroll_begin">
                            huiter 中了一等奖 huiter 中了一等奖 huiter 中了一等奖 huiter 中了一等奖 huiter 中了一等奖 huiter 中了一等奖 huiter 中了一等奖 huiter 中了一等奖 huiter 中了一等奖
                        </div>
                        <div id="scroll_end"></div>
                    </div>
                    <script type="text/javascript">ScrollImgLeft();</script>
                </div>
            </div>
            <div>
                <div id="sina-btn" style="color:#898989;font-size:12px;height:20px;margin-top:10px;" >
                    <img src="{% static 'images/share.png' %}" width=9 height=12>
                    分享就抽奖，今天还可以分享并抽
                    <span id="count">2</span>
                    次
                </div>
            </div>
            <div class="rotate">
                <div class="rotate-bg"></div>
                <div class="btn-lottery"></div>
            </div>
            <div>
                <a href="{% url 'lotto_share_to_sina_weibo' %}">
                    <div id="sina-btn" class="sina-btn" >
                        <img src="{% static 'images/sina.png' %}" width=17 height=13>微博分享试一下
                    </div>
                </a>
            </div>
            <div>
                <div style="margin:16px auto 0;width:210px;height:16px;">
                    <img src="{% static 'images/title.png' %}" width=210 height=16></div>
            </div>
            <div>
                <div style="margin:0px auto 10px;width:320px;height:1px;">
                    <img src="{% static 'images/line.png' %}" width=320 height=1></div>
            </div>
            <div style="text-align:left;color:#898989;font-size:11px;line-height:150%;">
                <div style="padding:10px 25px 10px 25px;">
                    <p style="margin-top:0px;">
                        <span style="font-size:13px;color:#666;">活动时间：</span>
                        2014年2月25日 - 2014年3月4日
                    </p>
                    <p style="margin-top:10px;">
                        <span style="font-size:13px;color:#666;">活动规则：</span>
                        成功分享至微博即可获得1次抽奖机会，每人每天最多2次抽奖机会。
                    </p>
                    <p style="margin-top:10px;">
                        <span style="font-size:13px;color:#666;">奖品发放：</span>
                        转盘获奖后，请耐心等待。活动结束后一周内，果库工作人员会统一通过微博私信联系所有获奖用户，安排奖品发送。
                    </p>
                </div>
            </div>
        </div>
    </body>
</html>

<script src="{% static 'scripts/jquery.js' %}"></script>
<script src="{% static 'scripts/jqueryrotate.js' %}"></script>
<script type="text/javascript">
    var count = 1;
    var token = "";
    var session = "{{session}}";
    $(function () {
        var rotateStart = function (awards, angle, text) {  //awards:奖项，angle:奖项对应的角度
            $('.btn-lottery').stopRotate();
            $(".btn-lottery").rotate({
                angle: 0,
                duration: 5000,
                animateTo: angle + 1440, //angle是图片上各奖项对应的角度，1440是我要让指针旋转4圈。所以最后的结束的角度就是这样子^^
                callback: function () {
                    alert(text)
                }
            });
        };

        $(".btn-lottery").rotate({
            bind: {
                click: function () {
                            if (count == 0) {
                                alert('先分享，后抽奖！');
                                return;
                             }
                             else
                             {
                                    $.ajax({
                                      url: "{% url 'lotto_roll' %}",
                                      data: {
                                        "session" : session,
                                        "token" : token 
                                      },
                                      type: "GET",
                                      success: function(data) {
                                        var code = data['code'];
                                        if (data == 0) {
                                            var angle = [0,120, 240];
                                            angle = angle[Math.floor(Math.random() * angle.length)]
                                            rotateStart(0, angle, '很遗憾，这次您未抽中奖')
                                        }
                                        if (code == 1) {
                                            rotateStart(1, 180, '恭喜您抽中的一等奖')
                                        }
                                        if (code == 2) {
                                            rotateStart(2, 300, '恭喜您抽中的二等奖')
                                        }
                                        if (code == 3) {
                                            rotateStart(3, 60, '恭喜您抽中的三等奖')
                                        }
                                        if (code == 4) {
                                            alert('抽奖次数超限')
                                        }
                                        if (code == 5) {
                                            alert('请先去分享')
                                        }
            

                                      },
                                      error: function(data) {

                                  }});

                             }
                }
            }
        });
//        $('.sina-btn').click(function(){
//            $.ajax({
//                url: "{% url 'lotto_share_to_sina_weibo' %}",
//                data: {
//                    'token' : token
//                },
//                type: 'GET',
//                success: function(data) {
//                var code = data['code'];
//                if (code == 0) {
//                    token = data['token'];
//                    count = count+1;
//                    alert('获得一次抽奖机会，点击按钮抽奖吧！')
//                }
//                else if (code == 1) {
//                    alert('已达到今日上限')
//                }else 
//                {
//
//                };
//
//                },
//                error: function(data) {
//
//              }});
//            }

        )
    });
</script>
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24696872-5']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
